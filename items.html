<!DOCTYPE html>

<html class="light" lang="ru">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>База предметов</title>
  <!-- PWA мета-теги -->
  <meta name="theme-color" content="#137fec" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="assets/icons/icon-192.svg" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <link href="https://fonts.googleapis.com" rel="preconnect" />
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="assets/tailwind.css" />
  <style>
    /* Hide scrollbar for Chrome, Safari and Opera */
    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }

    /* Hide scrollbar for IE, Edge and Firefox */
    .no-scrollbar {
      -ms-overflow-style: none;
      /* IE and Edge */
      scrollbar-width: none;
      /* Firefox */
    }

    .hide-scroll::-webkit-scrollbar {
      display: none;
    }

    .hide-scroll {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
  </style>
  <style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
</head>

<body
  class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-white h-screen overflow-hidden flex flex-col">
  <div class="w-full max-w-7xl mx-auto flex-1 flex flex-col h-full">
    <!-- Top App Bar -->
    <header class="flex-none bg-white dark:bg-[#1e293b] shadow-sm z-20 pb-2 pt-safe-top">
      <div class="flex items-center px-4 py-3 gap-1">
        <button
          class="flex size-10 items-center justify-center rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
          data-navigate="index.html">
          <span class="material-symbols-outlined text-slate-900 dark:text-white"
            style="font-size: 24px;">arrow_back</span>
        </button>
        <h2
          class="text-slate-900 dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center">
          База предметов</h2>
        <div class="flex items-center gap-1">
          <button
            class="flex size-10 items-center justify-center rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
            id="help-btn">
            <span class="material-symbols-outlined text-slate-900 dark:text-white" style="font-size: 24px;">help</span>
          </button>
          <button
            class="flex size-10 items-center justify-center rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
            <span class="material-symbols-outlined text-slate-900 dark:text-white"
              style="font-size: 24px;">filter_list</span>
          </button>
        </div>
      </div>
      <!-- Search Bar -->
      <div class="px-4 pb-2">
        <label class="flex flex-col h-12 w-full">
          <div
            class="flex w-full flex-1 items-stretch rounded-lg h-full bg-[#e7edf3] dark:bg-slate-800 transition-colors">
            <div class="flex items-center justify-center pl-4 pr-2">
              <span class="material-symbols-outlined text-[#4c739a] dark:text-slate-400"
                style="font-size: 24px;">search</span>
            </div>
            <input
              id="items-search-input"
              class="flex w-full min-w-0 flex-1 resize-none overflow-hidden bg-transparent text-slate-900 dark:text-white focus:outline-0 focus:ring-0 border-none h-full placeholder:text-[#4c739a] dark:placeholder:text-slate-500 text-base font-normal leading-normal"
              placeholder="Поиск по названию..." value="" />
          </div>
        </label>
        <div class="mt-2 flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400">
          <input id="search-by-sku" type="checkbox" checked
            class="size-4 rounded border-slate-300 text-primary focus:ring-primary dark:border-slate-600 dark:bg-slate-800" />
          <label for="search-by-sku" class="cursor-pointer select-none">Искать по артикулу</label>
        </div>
      </div>
      <!-- Filter Chips -->
      <div class="flex gap-2 px-4 py-2 overflow-x-auto no-scrollbar">
        <!-- Active Chip -->
        <button
          class="flex h-9 shrink-0 items-center justify-center gap-x-2 rounded-full bg-primary px-5 transition-colors shadow-sm">
          <p class="text-white text-sm font-medium leading-normal">Все</p>
        </button>
        <!-- Inactive Chips -->
        <button
          class="flex h-9 shrink-0 items-center justify-center gap-x-2 rounded-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 px-5 transition-colors">
          <p class="text-slate-700 dark:text-slate-300 text-sm font-medium leading-normal">Посуда</p>
        </button>
        <button
          class="flex h-9 shrink-0 items-center justify-center gap-x-2 rounded-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 px-5 transition-colors">
          <p class="text-slate-700 dark:text-slate-300 text-sm font-medium leading-normal">Приборы</p>
        </button>
        <button
          class="flex h-9 shrink-0 items-center justify-center gap-x-2 rounded-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 px-5 transition-colors">
          <p class="text-slate-700 dark:text-slate-300 text-sm font-medium leading-normal">Бокалы</p>
        </button>
        <button
          class="flex h-9 shrink-0 items-center justify-center gap-x-2 rounded-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 px-5 transition-colors">
          <p class="text-slate-700 dark:text-slate-300 text-sm font-medium leading-normal">Инвентарь</p>
        </button>
        <button
          class="flex h-9 shrink-0 items-center justify-center gap-x-2 rounded-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 px-5 transition-colors">
          <p class="text-slate-700 dark:text-slate-300 text-sm font-medium leading-normal">Расходники</p>
        </button>
      </div>
    </header>
    <!-- Main Content List -->
    <main class="flex-1 overflow-y-auto p-4 space-y-3 pb-24 no-scrollbar">

    </main>
    <!-- Floating Action Button -->
    <button id="add-item-fab"
      class="fixed bottom-24 right-5 bg-primary hover:bg-blue-600 text-white rounded-full p-4 shadow-lg shadow-blue-500/40 z-[90] transition-all active:scale-95 flex items-center justify-center">
      <span class="material-symbols-outlined" style="font-size: 28px;">add</span>
    </button>
    <!-- Bottom Navigation -->
    <nav
      class="fixed bottom-0 left-0 w-full bg-surface-light/95 dark:bg-surface-dark/95 backdrop-blur-lg border-t border-slate-200 dark:border-slate-800 pb-safe pt-2 px-6 h-[80px] z-[100] shadow-[0_-4px_20px_-4px_rgba(0,0,0,0.1)]">
      <div class="flex justify-between items-center max-w-md mx-auto h-full pb-4">
        <button
          class="flex flex-col items-center justify-center gap-1 w-16 text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300 transition-colors nav-button"
          data-navigate="index.html" data-nav-page="index">
          <span class="material-symbols-outlined text-[26px]">dashboard</span>
          <span class="text-[10px] font-medium">Главная</span>
        </button>
        <button class="flex flex-col items-center justify-center gap-1 w-16 text-primary nav-button"
          data-nav-page="items">
          <span class="material-symbols-outlined filled-icon text-[26px]">list_alt</span>
          <span class="text-[10px] font-medium">Список</span>
        </button>
        <button
          class="flex flex-col items-center justify-center gap-1 w-16 text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300 transition-colors nav-button"
          data-navigate="items-management.html" data-nav-page="management">
          <span class="material-symbols-outlined text-[26px]">settings</span>
          <span class="text-[10px] font-medium">Данные</span>
        </button>
        <button
          class="flex flex-col items-center justify-center gap-1 w-16 text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300 transition-colors nav-button"
          data-navigate="inventory-history.html" data-nav-page="history">
          <span class="material-symbols-outlined text-[26px]">bar_chart</span>
          <span class="text-[10px] font-medium">Отчеты</span>
        </button>
      </div>
    </nav>
    <!-- Модальное окно добавления новой позиции -->
    <div id="add-item-modal"
      class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/50 backdrop-blur-sm">
      <div
        class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl mx-4 w-full max-w-md max-h-[90vh] overflow-y-auto hide-scroll">
        <div
          class="sticky top-0 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-6 py-4 flex items-center justify-between z-10">
          <h3 class="text-lg font-bold text-slate-900 dark:text-white">Добавить новую позицию</h3>
          <button id="close-add-item-modal"
            class="flex size-8 items-center justify-center rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-400 transition-colors">
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>

        <div class="p-6 space-y-4">
          <!-- Название -->
          <div>
            <label class="block text-xs font-bold text-slate-700 dark:text-slate-300 mb-1.5 flex items-center gap-2">
              Название товара *
              <button
                class="hint-toggle-btn text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors"
                data-field="name" type="button">
                <span class="material-symbols-outlined text-sm">info</span>
              </button>
            </label>
            <input id="add-item-name"
              class="add-item-field w-full bg-white dark:bg-slate-800 border-2 rounded-xl px-3 py-2.5 text-sm font-medium transition-colors border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-primary focus:border-primary outline-none"
              placeholder="Название товара" type="text" data-field="name" />
            <div
              class="hint-content hidden mt-1.5 p-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-xs text-slate-600 dark:text-slate-400"
              data-field="name">
              Обязательное поле. Название товара должно быть заполнено.
            </div>
          </div>

          <!-- Артикул -->
          <div>
            <label class="block text-xs font-bold text-slate-700 dark:text-slate-300 mb-1.5 flex items-center gap-2">
              Артикул (SKU) *
              <button
                class="hint-toggle-btn text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors"
                data-field="sku" type="button">
                <span class="material-symbols-outlined text-sm">info</span>
              </button>
            </label>
            <div class="relative">
              <input id="add-item-sku"
                class="add-item-field w-full bg-white dark:bg-slate-800 border-2 rounded-xl px-3 py-2.5 text-sm font-medium transition-colors border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-primary focus:border-primary outline-none"
                placeholder="Артикул" type="text" data-field="sku" />
              <span
                class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 material-symbols-outlined text-lg hidden field-icon">check_circle</span>
            </div>
            <div
              class="hint-content hidden mt-1.5 p-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-xs text-slate-600 dark:text-slate-400"
              data-field="sku">
              Обязательное поле. Артикул должен быть уникальным и не повторяться в базе данных.
            </div>
          </div>

          <!-- Категория и Место хранения -->
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-xs font-bold text-slate-700 dark:text-slate-300 mb-1.5 flex items-center gap-2">
                Категория *
                <button
                  class="hint-toggle-btn text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors"
                  data-field="category" type="button">
                  <span class="material-symbols-outlined text-sm">info</span>
                </button>
              </label>
              <select id="add-item-category"
                class="add-item-field w-full bg-white dark:bg-slate-800 border-2 rounded-xl px-3 py-2.5 text-sm font-medium transition-colors border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-primary focus:border-primary outline-none"
                data-field="category">
                <option value="">Выберите категорию</option>
                <option value="Посуда">Посуда</option>
                <option value="Бокалы">Бокалы</option>
                <option value="Приборы">Приборы</option>
                <option value="Инвентарь">Инвентарь</option>
                <option value="Расходники">Расходники</option>
                <option value="Прочее">Прочее</option>
              </select>
              <div
                class="hint-content hidden mt-1.5 p-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-xs text-slate-600 dark:text-slate-400"
                data-field="category">
                Обязательное поле. Выберите одну из категорий: Посуда, Бокалы, Приборы, Инвентарь, Расходники, Прочее.
              </div>
            </div>
            <div>
              <label class="block text-xs font-bold text-slate-700 dark:text-slate-300 mb-1.5 flex items-center gap-2">
                Место хранения *
                <button
                  class="hint-toggle-btn text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors"
                  data-field="location" type="button">
                  <span class="material-symbols-outlined text-sm">info</span>
                </button>
              </label>
              <select id="add-item-location"
                class="add-item-field w-full bg-white dark:bg-slate-800 border-2 rounded-xl px-3 py-2.5 text-sm font-medium transition-colors border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-primary focus:border-primary outline-none"
                data-field="location">
                <option value="">Выберите место</option>
                <option value="Бар">Бар</option>
                <option value="Кухня">Кухня</option>
                <option value="Склад">Склад</option>
                <option value="Другое">Другое</option>
              </select>
              <input id="add-item-location-custom"
                class="add-item-field mt-2 w-full bg-white dark:bg-slate-800 border-2 rounded-xl px-3 py-2.5 text-sm font-medium focus:ring-2 focus:ring-primary focus:border-primary outline-none hidden"
                placeholder="Введите свой вариант" type="text" data-field="location-custom" />
              <div
                class="hint-content hidden mt-1.5 p-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-xs text-slate-600 dark:text-slate-400"
                data-field="location">
                Обязательное поле. Выберите место хранения: Бар, Кухня, Склад, или выберите "Другое" и введите свой
                вариант.
              </div>
            </div>
          </div>

          <!-- Единица измерения -->
          <div>
            <label class="block text-xs font-bold text-slate-700 dark:text-slate-300 mb-1.5 flex items-center gap-2">
              Единица измерения *
              <button
                class="hint-toggle-btn text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors"
                data-field="unit" type="button">
                <span class="material-symbols-outlined text-sm">info</span>
              </button>
            </label>
            <div class="relative">
              <select id="add-item-unit"
                class="add-item-field w-full bg-white dark:bg-slate-800 border-2 rounded-xl px-3 py-2.5 text-sm font-medium transition-colors border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-primary focus:border-primary outline-none"
                data-field="unit">
                <option value="">Выберите единицу</option>
                <option value="шт.">шт.</option>
                <option value="комп.">комп.</option>
                <option value="упак.">упак.</option>
              </select>
              <span
                class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 material-symbols-outlined text-lg hidden field-icon pointer-events-none">check_circle</span>
            </div>
            <div
              class="hint-content hidden mt-1.5 p-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-xs text-slate-600 dark:text-slate-400"
              data-field="unit">
              Обязательное поле. Выберите единицу измерения: шт., комп., упак.
            </div>
          </div>

          <!-- Описание -->
          <div>
            <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1.5 flex items-center gap-2">
              Описание
              <button
                class="hint-toggle-btn text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors"
                data-field="description" type="button">
                <span class="material-symbols-outlined text-sm">info</span>
              </button>
            </label>
            <input id="add-item-description"
              class="add-item-field w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl px-3 py-2.5 text-sm font-medium focus:ring-2 focus:ring-primary focus:border-primary outline-none"
              placeholder="Описание (необязательно)" type="text" data-field="description" />
            <div
              class="hint-content hidden mt-1.5 p-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-xs text-slate-600 dark:text-slate-400"
              data-field="description">
              Необязательное поле. Если указано, описание должно быть уникальным.
            </div>
          </div>

          <!-- Загрузка фото -->
          <div>
            <label class="block text-xs font-bold text-slate-700 dark:text-slate-300 mb-1.5 flex items-center gap-2">
              Фото товара
              <button
                class="hint-toggle-btn text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors"
                data-field="image" type="button">
                <span class="material-symbols-outlined text-sm">info</span>
              </button>
            </label>
            <div class="relative">
              <input id="add-item-image" type="file" accept="image/*" class="hidden" data-field="image" />
              <div id="add-item-image-preview" class="hidden mb-2">
                <img id="add-item-image-preview-img" src="" alt="Превью"
                  class="w-full h-48 object-cover rounded-xl border border-slate-200 dark:border-slate-700" />
                <button id="add-item-image-remove"
                  class="mt-2 text-xs font-bold text-red-600 hover:text-red-800">Удалить фото</button>
              </div>
              <button id="add-item-image-btn" type="button"
                class="w-full bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-xl px-3 py-4 text-sm font-medium text-slate-700 dark:text-slate-300 transition-colors flex items-center justify-center gap-2">
                <span class="material-symbols-outlined">image</span>
                <span>Выбрать фото</span>
              </button>
            </div>
            <div
              class="hint-content hidden mt-1.5 p-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-xs text-slate-600 dark:text-slate-400"
              data-field="image">
              Необязательное поле. Вы можете загрузить фото товара. Поддерживаются форматы: JPG, PNG, GIF.
            </div>
          </div>

          <!-- Кнопки действий -->
          <div class="flex gap-3 pt-4 border-t border-slate-200 dark:border-slate-700">
            <button id="add-item-cancel"
              class="flex-1 py-3 px-4 rounded-xl font-bold text-slate-700 dark:text-slate-300 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors">
              Отмена
            </button>
            <button id="add-item-save"
              class="flex-1 py-3 px-4 rounded-xl font-bold text-white bg-primary hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
              Сохранить
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Подключение JavaScript модулей -->
    <script type="module" src="js/app.js"></script>
    <!-- Регистрация Service Worker для PWA -->
    <script>
      let refreshing = false;

      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js')
            .then(reg => {
              console.log('Service Worker зарегистрирован:', reg.scope);

              // Если появилось обновление, мы можем сказать об этом пользователю
              reg.onupdatefound = () => {
                const installingWorker = reg.installing;
                installingWorker.onstatechange = () => {
                  if (installingWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    console.log('Доступно обновление! Перезагрузите страницу.');
                  }
                };
              };
            })
            .catch(err => console.log('Service Worker ошибка:', err));
        });

        // Убрали автоматическую перезагрузку, так как она вызывала циклы на некоторых страницах
      }
    </script>
</body>

</html>
